# Деплой Telegram-бота Потолкоф

## Локальный запуск

### Требования
- Установленный Node.js (версия 14 или выше)
- Установленный npm (обычно идет вместе с Node.js)

### Шаги для локального запуска

1. **Клонирование/создание проекта**
   Если вы клонируете проект:
   ```bash
   git clone <ссылка_на_репозиторий>
   cd potolkoff-telegram-bot
   ```

   Если вы создаете проект заново, просто перейдите в директорию проекта.

2. **Установка зависимостей**
   ```bash
   npm install
   ```

3. **Настройка токена**
   - Создайте нового бота у [@BotFather](https://t.me/BotFather) в Telegram
   - Получите токен
   - Создайте файл `.env` в корне проекта (если его нет) и укажите токен:
     ```
     BOT_TOKEN=ваш_токен_бота_здесь
     ```

4. **Запуск бота**
   ```bash
   npm start
   ```

## Запуск в режиме разработки

Для автоматической перезагрузки при изменении кода:
```bash
npm run dev
```

> Примечание: для этого нужно установить nodemon глобально: `npm install -g nodemon`

## Деплой на хостинг

### На VPS/Выделенный сервер

1. Установите Node.js на сервере
2. Скопируйте файлы проекта на сервер
3. Установите зависимости: `npm install`
4. Установите PM2 для управления процессами: `npm install -g pm2`
5. Запустите бота с помощью PM2:
   ```bash
   pm2 start bot.js --name "potolkoff-bot"
   ```
6. Настройте автозапуск: `pm2 startup`
7. Сохраните конфигурацию: `pm2 save`

### На Heroku

1. Установите Heroku CLI
2. Войдите в аккаунт: `heroku login`
3. Создайте приложение: `heroku create название_приложения`
4. Установите токен как конфигурационную переменную:
   ```bash
   heroku config:set BOT_TOKEN=ваш_токен_бота_здесь
   ```
5. Загрузите код: `git push heroku main`

### На Railway

1. Зарегистрируйтесь на [Railway.app](https://railway.app)
2. Создайте новое приложение
3. Подключите репозиторий GitHub или загрузите код
4. Установите переменную окружения `BOT_TOKEN`
5. Разверните приложение

### На Beget (вместе с основным сайтом)

Если вы хотите разместить бота на том же хостинге, что и основной сайт:

1. Загрузите файлы проекта в отдельную директорию на хостинге
2. Установите Node.js через панель управления (если не установлен)
3. Установите зависимости через SSH или панель управления
4. Запустите бота через панель управления или PM2

## Использование Webhook (для продвинутых)

Вместо опроса (polling), можно использовать вебхуки для получения обновлений от Telegram:

1. Укажите URL вебхука в `.env`:
   ```
   WEBHOOK_URL=https://ваш_домен.com/webhook
   ```

2. Измените код бота для использования вебхуков:
   ```javascript
   bot.telegram.setWebhook('https://ваш_домен.com/webhook');

   app.use(bot.webhookCallback('/webhook'));
   ```

## Мониторинг и логирование

### Логирование
Все запросы к боту автоматически логируются в консоль. Для сохранения логов в файл:

```javascript
const fs = require('fs');
const logStream = fs.createWriteStream('bot.log', { flags: 'a' });

// Добавьте в middleware
app.use((req, res, next) => {
    const timestamp = new Date().toISOString();
    logStream.write(`${timestamp} - ${req.method} ${req.url}\n`);
    next();
});
```

### Мониторинг производительности
Используйте такие инструменты, как:
- PM2 для управления процессами
- New Relic или DataDog для мониторинга производительности
- Sentry для отслеживания ошибок

## Безопасность

1. **Не публикуйте токен бота** в открытых репозиториях
2. **Используйте файл .gitignore**, чтобы исключить файл `.env`
3. **Проверяйте обновления зависимостей**: `npm audit`
4. **Ограничьте доступ к серверу** только необходимыми IP-адресами

## Резервное копирование

Регулярно создавайте резервные копии:
- Файлов проекта
- Конфигурационных файлов
- Данных (если бот хранит информацию)

## Обновление бота

Для обновления бота:

1. Сделайте резервную копию
2. Загрузите новые файлы
3. Установите новые зависимости (если есть): `npm install`
4. Перезапустите бота

## Устранение неполадок

### Бот не отвечает
- Проверьте, запущен ли процесс
- Убедитесь, что токен указан правильно
- Проверьте соединение с интернетом

### Ошибки при запуске
- Убедитесь, что все зависимости установлены
- Проверьте синтаксис JavaScript
- Посмотрите логи ошибок

### Проблемы с производительностью
- Проверьте нагрузку на сервер
- Оптимизируйте код
- Рассмотрите масштабирование

## Заключение

Telegram-бот для компании "Потолкоф" может быть успешно развернут на различных платформах в зависимости от ваших потребностей и технических требований. Выбор подходящего метода деплоя зависит от объема трафика, требований к надежности и бюджета.